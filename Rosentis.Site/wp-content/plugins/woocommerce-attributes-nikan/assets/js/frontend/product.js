jQuery(function(a){var t="jcaa_active_attr",i="jcass_attr_disable",r="jcass_attr_disabled",e="jcaa_no_stock",n=a(".variations_form.cart").data("product_variations"),s={};if(void 0!=n&&n.length>0)for(var o in n){var l=n[o];if(0!=l.variation_is_visible||0!=l.variation_is_active||0!=l.is_purchasable)for(var v in l.attributes){var c=l.attributes[v];void 0==s[v]&&(s[v]=[]),-1==a.inArray(c,s[v])&&s[v].push(c)}}a('select[name^="attribute_pa_"]').each(function(){var t=a(this),i=a(this).attr("name").substr(10),r=function(a){if(null===jcaa_attrs)return!1;for(var t=0;t<jcaa_attrs.length;t++){var i=jcaa_attrs[t];if(i.name===a)return i}return!1}(i);if(!1!==r&&"default"!==r.type){"hide"===r.label&&t.parents("tr").find(".label").css("visibility","hidden");var e="";"rounded"===r.style&&"text"!==r.type&&(e+="jcaa_rounded_corners"),"large"===r.size?e+=" jcaa_size_large":"medium"===r.size?e+=" jcaa_size_medium":e+=" jcaa_size_small";var n="";n+='<ul id="jcaa_attr_'+i+'" class="jcaa_attr_select jcaa_attr_variable_select '+e+'">',t.find("option").each(function(){if(void 0!=s["attribute_"+r.name]){var i=s["attribute_"+r.name];if(a.inArray("",i)>-1||a.inArray(a(this).val(),i)>-1){var e=function(a,t){for(var i=0;i<a.options.length;i++){var r=a.options[i];if(r.value===t)return r}return!1}(r,a(this).val());!1!==e&&("image"===r.type?n+='<li><img src="'+e.img+'" alt="'+e.alt+'" title="'+e.name+'" data-target="#'+t.attr("id")+'" data-value="'+e.value+'" class="jcaa_attr_option jcaa_obj_image" /></li>':"color"===r.type?n+='<li><div style="background: '+e.color+';" data-target="#'+t.attr("id")+'" title="'+e.name+'" data-value="'+e.value+'" class="jcaa_attr_option jcaa_obj_color"></div></li>':"text"===r.type&&(n+='<li><a data-target="#'+t.attr("id")+'" data-value="'+e.value+'" title="'+e.name+'" class="jcaa_attr_option jcaa_obj_text">'+e.name+"</a></li>"))}}}),n+="</ul>";var o=t.parents(".value");o&&o.addClass("jcaa_select_enabled"),t.after(n),t.hide()}}),a(".variations_form.cart .jcaa_attr_select").each(function(){a(this).find(".jcaa_attr_option").each(function(){var t=a(this);t.click(function(r){if(a(this).hasClass(i))return r.preventDefault();var e=t.data("target");e=e.substr(1);var n=a(e='[id="'+e+'"]'),s=t.data("value");1==a(n).find('option[value="'+s+'"]').prop("selected")?"yes"==jcaa.enable_attr_toggle&&(a(n).find("option").attr("selected",!1),a(n).find("option:first").attr("selected",!0)):(a(n).find("option").attr("selected",!1),a(n).val(s),a(n).find('option[value="'+s+'"]').attr("selected",!0)),a(n).trigger("change"),r.preventDefault()})})});var d={find_matching_variations:function(a,t){var i=[];if(void 0!=a)for(var r=0;r<a.length;r++){var e=a[r];d.variations_match(e.attributes,t)&&i.push(e)}return i},variations_match:function(a,t){var i=!0;for(var r in a)if(a.hasOwnProperty(r)){var e=a[r],n=t[r];void 0!==e&&void 0!==n&&0!==e.length&&0!==n.length&&e!==n&&(i=!1)}return i}};a.fn.jcaaCheckAttrValidation=function(){var t=a(".variations_form.cart").data("product_variations"),n=[],s=!1,o=0,l=0;a(".variations select").each(function(){""!==a(this).val()?(o++,s=a(this).attr("name")):!0,n[a(this).attr("name")]=a(this).val(),l++}),a(".jcaa_attr_option").removeClass(i),a(".jcaa_attr_variable_select li").removeClass(e+" "+r);var v=[],c=[],_={},u=function(a){for(var t in a)if(void 0===_[t]||1!=_[t]){var i=a[t];""===i?_[t]=!0:(void 0===_[t]&&(_[t]=[]),-1===_[t].indexOf(i)&&_[t].push(i))}},f=function(a,t,i){if(void 0!==_[a]){if(!0===_[a])return!0;if(!1!==_[a]&&-1!==_[a].indexOf(t))return!0}return!1},h={};if(o>0)for(var b in n){var p=[];for(var j in n)p[j]=b==j?"":n[j];if(0!=(v=d.find_matching_variations(t,p)).length)for(var g=0;g<v.length;g++){!1===(A=v[g]).is_in_stock?c.push({attribute:b,value:A.attributes[b],force:!1}):(u(A.attributes),void 0==h[b]&&(h[b]=[]),"*"!=h[b]&&(""==A.attributes[b]?(h[b],h[b]="*"):-1===h[b].indexOf(A.attributes[b])&&h[b].push(A.attributes[b])))}}for(var m in h){var y=h[m],C=m.substr(10),k=a('[id="jcaa_attr_'+C+'"]');if("*"!=y){k.find(".jcaa_attr_option").addClass(i).parent().addClass(r);for(g=0;g<y.length;g++){var x=y[g];k.find('.jcaa_attr_option[data-value="'+x+'"]').removeClass(i).parent().removeClass(r)}}}if(o<l){v=d.find_matching_variations(t,n);var z=!1;if(o==l-1&&(z=!0),v.length>0)for(g=0;g<v.length;g++){var A;if(!1===(A=v[g]).is_in_stock){b=s;for(var O in A.attributes)""!==A.attributes[O]&&A.attributes[O]!==s&&c.push({attribute:O,value:A.attributes[O],force:z})}else u(A.attributes)}}var D={};if(c.length>0)for(g=0;g<c.length;g++){m=c[g].attribute;var V=c[g].value;if(void 0===D[m]&&(D[m]={}),!0!==f(m,V)||!0===c[g].force)if(!0!==c[g].force||""===n[m]){if(void 0===D[m][V]){C=m.substr(10);(k=a('[id="jcaa_attr_'+C+'"]')).find('.jcaa_attr_option[data-value="'+V+'"]').addClass(i).parent().addClass(e+" "+r)}}else void 0===D[m][V]&&(D[m][V]=!0);else void 0===D[m][V]&&(D[m][V]=!0)}},a("body").on("change",".variations select",function(){var i=a(this).attr("name").substr(10);a('ul[id="jcaa_attr_'+i+'"] .'+t).removeClass(t),a('ul[id="jcaa_attr_'+i+'"] [data-value="'+a(this).val()+'"]').parent().addClass(t),void 0!==jcaa.enable_validation&&"yes"==jcaa.enable_validation&&a.fn.jcaaCheckAttrValidation()}),a(".variations select").trigger("change")});